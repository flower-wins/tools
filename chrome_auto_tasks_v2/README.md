# Auto Tasks Scheduler (自动任务调度器)

**版本:** 2.0
**描述:** 一个 Chrome 浏览器扩展，用于定时打开网页、后台静默访问网址以及定时刷新标签页。

## 功能特性

本插件提供以下三种类型的定时任务：

1.  **每隔 N 天打开网页:**
    * 按照设定的间隔天数，在浏览器中自动打开指定的网页。
    * 例如，您可以设置每 1 天自动打开您的新闻主页。

2.  **每隔 N 分钟后台访问网址:**
    * 按照设定的间隔分钟数，在后台静默访问指定的网址。
    * 这对于需要定期“签到”或保持会话活动状态的网页非常有用，操作在后台进行，不会打扰您的正常浏览。

3.  **定时刷新标签页 (地址前缀匹配):**
    * 按照设定的间隔分钟数，自动刷新与设定地址前缀匹配的所有已打开的标签页。
    * 例如，您可以设置每 5 分钟刷新所有地址以 `https://example.com/dashboard` 开头的标签页，以保持数据更新。

## 如何使用

1.  **安装插件:**
    * 下载插件文件（或从源码构建）。
    * 打开 Chrome 浏览器，进入 `chrome://extensions/` 页面。
    * 开启右上角的“开发者模式” (Developer mode)。
    * 点击“加载已解压的扩展程序” (Load unpacked)，然后选择插件的根文件夹。

2.  **添加任务:**
    * 点击浏览器工具栏上的“Auto Tasks Scheduler”图标，打开插件的弹出管理界面。
    * 界面分为三个部分，分别对应上述三种任务类型。
    * **打开网页任务:**
        * 输入完整的网页地址 (例如 `https://example.com`)。
        * 输入间隔天数 (正整数)。
        * 点击“添加任务”按钮。
    * **后台访问任务:**
        * 输入完整的网页地址 (例如 `https://example.com`)。
        * 输入间隔分钟数 (正整数)。
        * 点击“添加后台访问任务”按钮。
    * **刷新标签页任务:**
        * 输入标签页的地址前缀 (例如 `https://example.com/dashboard`，插件会刷新所有以此开头的标签页)。
        * 输入间隔分钟数 (正整数)。
        * 点击“添加刷新任务”按钮。

3.  **管理任务:**
    * 添加的任务会显示在各自区域的列表中。
    * 每个任务会显示下一次预计执行的时间和设定的网址/前缀。
    * **删除任务:** 点击任务旁边的“删除任务”按钮，即可移除该定时任务。
    * **立即执行:** 点击任务旁边的“立即执行”按钮，可以不等预设时间到达，立刻执行一次该任务。

## 技术细节与文件结构

* **`manifest.json`**: 插件的配置文件，声明了插件的名称、版本、权限、背景脚本、弹出页面等。
    * **权限 (Permissions)**:
        * `storage`: 用于存储用户添加的任务列表。
        * `tabs`: 用于打开新标签页、查询现有标签页以及刷新标签页。
        * `alarms`: 用于设置定时任务的触发器。
        * `scripting`: (虽然在当前核心功能中未直接体现，但对于未来可能的更复杂交互或内容脚本注入可能是必要的，保留它是良好的实践)。
* **`popup.html`**: 用户界面的 HTML 结构，用户通过这个弹出窗口添加和管理任务。
* **`popup.js`**: 弹出窗口的 JavaScript 逻辑，负责：
    * 从 `chrome.storage.local` 读取并渲染任务列表。
    * 处理用户输入，验证并向存储中添加新任务。
    * 处理删除任务的请求，更新存储和界面。
    * 处理立即执行任务的请求，通过 `chrome.runtime.sendMessage` 通知背景脚本。
    * 遵循内容安全策略 (CSP)，使用 `addEventListener` 动态绑定事件。
* **`background.js` (Service Worker)**: 插件的后台服务工作线程，负责：
    * 初始化和管理 `chrome.alarms`，根据存储中的任务设置定时器。
    * 监听 `chrome.alarms.onAlarm` 事件，当闹钟触发时执行相应的任务（打开网页、后台 fetch、刷新标签页）。
    * 计算并更新任务的下一次执行时间，并重新设置闹钟。
    * 监听来自 `popup.js` 的 `runNow` 消息，立即执行指定的任务。
    * 监听 `chrome.storage.onChanged` 事件，当任务列表在存储中发生变化时，自动更新闹钟设置。
* **图标 (`icon16.png`, `icon48.png`, `icon128.png`)**: 插件在浏览器工具栏和扩展管理页面显示的图标。

## 开发与调试

* 如上所述，通过 `chrome://extensions/` 加载已解压的扩展程序。
* **调试 `popup.js`**: 右键点击插件图标打开的弹出窗口，选择“检查”，即可打开针对该弹出窗口的开发者工具。
* **调试 `background.js`**: 在 `chrome://extensions/` 页面，找到该插件，点击“服务工作线程” (Service worker) 链接，即可打开针对背景脚本的开发者工具。

## 未来可能的改进

* 为任务添加编辑功能。
* 提供更灵活的调度选项 (例如，指定具体时间执行，或选择每周的特定几天)。
* 任务执行成功或失败的通知。
* 导入/导出任务配置。
* UI/UX 优化。

---

希望这个 README 对您有所帮助！
